<script type="module">
  // Importa Firebase (versÃ£o modular)
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

  // ðŸ”‘ Config do Firebase
  const firebaseConfig = {
    apiKey: "SUA_API_KEY",
    authDomain: "fila-atendimento.firebaseapp.com",
    databaseURL: "https://fila-atendimento-default-rtdb.firebaseio.com",
    projectId: "fila-atendimento",
    storageBucket: "fila-atendimento.appspot.com",
    messagingSenderId: "813517035677",
    appId: "SUA_APP_ID"
  };

  // Inicializa Firebase
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // Estado global
  const state = { prefix: "A", number: 0, guiche: "1", ts: Date.now() };

  // ReferÃªncias aos elementos
  const el = {
    senhaBig: document.getElementById("senhaBig"),
    guicheTxt: document.getElementById("guicheTxt"),
    prefix: document.getElementById("prefix"),
    numero: document.getElementById("numero"),
    guiche: document.getElementById("guiche"),
    controls: document.querySelector(".controls")
  };

  // FunÃ§Ã£o auxiliar
  const pad = n => String(n).padStart(3, "0");

  function updateDisplay() {
    el.senhaBig.textContent = `${state.prefix}-${pad(state.number)}`;
    el.guicheTxt.textContent = `Dirija-se ao guichÃª ${state.guiche}`;
    el.prefix.value = state.prefix;
    el.numero.value = state.number;
    el.guiche.value = state.guiche;
  }

  // ðŸ”¥ SincronizaÃ§Ã£o com Firebase
  const stateRef = ref(db, "fila/state");

  // Escuta mudanÃ§as no banco
  onValue(stateRef, (snapshot) => {
    if (snapshot.exists()) {
      Object.assign(state, snapshot.val());
      updateDisplay();
    }
  });

  // Grava estado no banco
  function broadcast() {
    state.ts = Date.now();
    set(stateRef, state);
  }

  // Eventos UI
  el.prefix.addEventListener("input", () => { state.prefix = el.prefix.value.toUpperCase(); broadcast(); });
  el.numero.addEventListener("change", () => { state.number = parseInt(el.numero.value || 0); broadcast(); });
  el.guiche.addEventListener("input", () => { state.guiche = el.guiche.value; broadcast(); });

  function next() {
    state.number++;
    broadcast();
  }

  // Atalho no teclado
  window.addEventListener("keydown", (e) => {
    if (e.key.toLowerCase() === "n") next();
  });

  updateDisplay();

  // Modo painel (sem controles)
  if (window.location.search.includes("painel=1")) {
    el.controls.style.display = "none";
  }
</script>
