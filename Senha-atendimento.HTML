<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chamada de Senhas</title>
  <style>
    :root {
      --bg: #0f172a;       /* slate-900 */
      --panel: #111827;    /* gray-900 */
      --card: #1f2937;     /* gray-800 */
      --text: #e5e7eb;     /* gray-200 */
      --muted: #9ca3af;    /* gray-400 */
      --accent: #22c55e;   /* green-500 */
      --danger: #ef4444;   /* red-500 */
      --warn: #f59e0b;     /* amber-500 */
      --brand: #60a5fa;    /* blue-400 */
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1000px 600px at 10% -20%, #111827, var(--bg));
      color: var(--text);
    }
    .container { max-width: 1100px; margin: 0 auto; padding: 24px; }
    header { display: flex; align-items: center; justify-content: space-between; gap: 16px; }
    .brand { display: flex; align-items: center; gap: 12px; font-weight: 700; }
    .brand .dot { width: 12px; height: 12px; border-radius: 999px; background: linear-gradient(135deg, var(--brand), #7dd3fc); box-shadow: 0 0 12px #38bdf8; }
    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 20px;
      padding: 18px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25), inset 0 1px 0 rgba(255,255,255,0.06);
    }
    .grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 16px; }

    .display { grid-column: span 14; display: flex; flex-direction: column; gap: 16px; }
    .display .now { font-size: clamp(32px, 4vw, 48px); color: var(--muted); font-weight: 600; letter-spacing: .04em; }
    .display .ticket {
      display: flex; align-items: center; justify-content: center; text-align: center;
      border-radius: 24px; padding: 18px; min-height: 230px;
      background: radial-gradient(800px 300px at 10% -40%, rgba(96,165,250,0.2), transparent),
                  linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
      border: 1px solid rgba(255,255,255,0.08);
    }
    .ticket .big {
      font-variant-numeric: tabular-nums; line-height: 1.1;
      font-weight: 800; letter-spacing: .03em;
      font-size: clamp(72px, 12vw, 160px);
      text-shadow: 0 6px 28px rgba(96,165,250,0.35);
    }
    .ticket .guiche { font-size: clamp(18px, 2.2vw, 28px); opacity: .9; margin-top: 8px; }
    .controls { grid-column: span 5; display: flex; flex-direction: column; gap: 16px; }

    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .field { display: flex; flex-direction: column; gap: 6px; }
    label { font-size: 14px; color: var(--muted); }
    input, select { width: 100%; padding: 12px 14px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); background: #0b1221; color: var(--text); outline: none; }
    input:focus, select:focus { border-color: var(--brand); box-shadow: 0 0 0 4px rgba(96,165,250,0.15); }

    .btns { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
    button { padding: 12px 14px; border-radius: 14px; border: 1px solid rgba(255,255,255,0.1); background: #101827; color: var(--text); font-weight: 600; cursor: pointer; }
    button.primary { background: linear-gradient(135deg, #22c55e, #16a34a); border-color: rgba(34,197,94,0.6); }
    button.warn { background: linear-gradient(135deg, #f59e0b, #d97706); border-color: rgba(245,158,11,0.6); }
    button.danger { background: linear-gradient(135deg, #ef4444, #dc2626); border-color: rgba(239,68,68,0.6); }
    button.ghost { background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02)); }
    button:active { transform: translateY(1px); }

    footer { margin-top: 18px; display: flex; justify-content: space-between; align-items: center; color: var(--muted); font-size: 13px; }
    kbd { background: #0b1221; border: 1px solid rgba(255,255,255,0.12); padding: 2px 6px; border-radius: 6px; font-size: 12px; }

    .panel-only .controls { display: none !important; }
    .panel-only header .brand span { opacity: .6; }
    .panel-only .display { grid-column: 1 / -1; }

    @media (max-width: 900px) {
      .grid { grid-template-columns: 1fr; }
      .display, .controls { grid-column: auto; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="dot"></div>
        <span>Chamada de Senhas</span>
      </div>
      <div id="status" aria-live="polite" style="font-size:13px;color:var(--muted)">Conectando…</div>
    </header>

    <main class="grid" id="main">
      <section class="display">
        <div class="now">Em atendimento</div>
        <div class="ticket card">
          <div>
            <div class="big" id="senhaBig">A-000</div>
            <div class="guiche" id="guicheTxt">Dirija-se ao guichê 1</div>
          </div>
        </div>
      </section>

      <aside class="controls">
        <div class="card" style="display:flex;flex-direction:column;gap:12px">
          <div class="row">
            <div class="field">
              <label for="prefix">Prefixo</label>
              <input id="prefix" maxlength="3" value="A" />
            </div>
            <div class="field">
              <label for="numero">Número atual</label>
              <input id="numero" type="number" min="0" value="0" />
            </div>
          </div>
          <div class="row">
            <div class="field">
              <label for="guiche">Guichê / Mesa</label>
              <input id="guiche" value="1" />
            </div>
            <div class="field">
              <label for="voz">Voz</label>
              <select id="voz"></select>
            </div>
          </div>

          <div class="btns">
            <button class="primary" id="btnNext">Próxima senha (N)</button>
            <button class="ghost" id="btnRepeat">Repetir anúncio (R)</button>
            <button class="ghost" id="btnBack">Voltar (B)</button>
            <button class="warn" id="btnReset">Resetar</button>
            <button class="ghost" id="btnPainel">Abrir modo painel</button>
            <button class="danger" id="btnClear">Zerar contador</button>
          </div>
        </div>

        <div class="card" style="font-size:13px;line-height:1.5">
          <div style="float:8px">
            Atalhos: <kbd>N</kbd> próxima, <kbd>R</kbd> repetir, <kbd>B</kbd> voltar, <kbd>0</kbd> zerar.
          </div>
        </div>
      </aside>
    </main>

    <footer>
      <div>
        <span id="clock">--:--</span>
      </div>
      <div>
        <span id="syncInfo">Canal: ativo</span>
      </div>
    </footer>
  </div>

  <script>
    // ------------------ Estado ------------------
   


    // ------------------ UI refs ------------------
    const el = {
      senhaBig: document.getElementById('senhaBig'),
      guicheTxt: document.getElementById('guicheTxt'),
      prefix: document.getElementById('prefix'),
      numero: document.getElementById('numero'),
      guiche: document.getElementById('guiche'),
      voz: document.getElementById('voz'),
      status: document.getElementById('status'),
      syncInfo: document.getElementById('syncInfo'),
      clock: document.getElementById('clock'),
      btnNext: document.getElementById('btnNext'),
      btnRepeat: document.getElementById('btnRepeat'),
      btnBack: document.getElementById('btnBack'),
      btnReset: document.getElementById('btnReset'),
      btnClear: document.getElementById('btnClear'),
      btnPainel: document.getElementById('btnPainel'),
      main: document.getElementById('main')
    };

    // ------------------ Util ------------------
    const pad = n => String(n).padStart(3, '0');
    function updateDisplay() {
      el.senhaBig.textContent = `${state.prefix.toUpperCase()}-${pad(state.number)}`;
      el.guicheTxt.textContent = `Dirija-se ao guichê ${state.guiche}`;
      el.prefix.value = state.prefix;
      el.numero.value = state.number;
      el.guiche.value = state.guiche;
      saveState();
    }

    function saveState() {
      try { localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); } catch {}
    }
    function loadState() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (raw) {
          const s = JSON.parse(raw);
          Object.assign(state, s);
        }
      } catch {}
      updateDisplay();
    }

    // ------------------ Áudio: sino + TTS ------------------
    function playChime() {
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const o = ctx.createOscillator();
      const g = ctx.createGain();
      o.type = 'triangle';
      o.frequency.value = 880;
      o.connect(g); g.connect(ctx.destination);
      g.gain.setValueAtTime(0.0001, ctx.currentTime);
      g.gain.exponentialRampToValueAtTime(0.4, ctx.currentTime + 0.02);
      g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.4);
      o.start(); o.stop(ctx.currentTime + 0.45);
    }

    const VOICE_LANG_PREF = ['pt-BR', 'pt_PT', 'pt'];
    function populateVoices() {
      const voices = speechSynthesis.getVoices();
      el.voz.innerHTML = '';
      voices.forEach((v, i) => {
        const opt = document.createElement('option');
        opt.value = v.name; opt.textContent = `${v.name} (${v.lang})`;
        if (VOICE_LANG_PREF.some(l => v.lang.startsWith(l))) opt.selected = true;
        el.voz.appendChild(opt);
      });
      if (!voices.length) {
        const opt = document.createElement('option');
        opt.value = ''; opt.textContent = 'Padrão do sistema';
        el.voz.appendChild(opt);
      }
    }
    speechSynthesis.onvoiceschanged = populateVoices;

    function speakSentence(text) {
      const u = new SpeechSynthesisUtterance(text);
      const name = el.voz.value;
      const voice = speechSynthesis.getVoices().find(v => v.name === name);
      if (voice) u.voice = voice;
      u.lang = (voice && voice.lang) || 'pt-BR';
      u.rate = 1; u.pitch = 1; u.volume = 1;
      speechSynthesis.cancel();
      speechSynthesis.speak(u);
    }

    function announce() {
      playChime();
      const frase = `Senha ${state.prefix} ${state.number}, dirigir-se ao guichê ${state.guiche}.`;
      // pequena pausa para o sino
      setTimeout(() => speakSentence(frase), 420);
    }

    // ------------------ Ações ------------------
    function next() {
      state.number += 1; state.ts = Date.now();
      updateDisplay(); announce(); broadcast();
    }
    function back() {
      state.number = Math.max(0, state.number - 1); state.ts = Date.now();
      updateDisplay(); announce(); broadcast();
    }
    function resetToZero() {
      state.number = 0; state.ts = Date.now();
      updateDisplay(); broadcast();
    }

    // ------------------ Eventos UI ------------------
    el.prefix.addEventListener('input', () => { state.prefix = el.prefix.value.toUpperCase(); state.ts = Date.now(); updateDisplay(); broadcast(); });
    el.numero.addEventListener('change', () => { state.number = parseInt(el.numero.value||'0', 10)||0; state.ts = Date.now(); updateDisplay(); broadcast(); });
    el.guiche.addEventListener('input', () => { state.guiche = el.guiche.value; state.ts = Date.now(); updateDisplay(); broadcast(); });

    el.btnNext.addEventListener('click', next);
    el.btnBack.addEventListener('click', back);
    el.btnRepeat.addEventListener('click', announce);
    el.btnReset.addEventListener('click', () => { resetToZero(); announce(); });
    el.btnClear.addEventListener('click', () => { if (confirm('Zerar contador para 0?')) resetToZero(); });

    el.btnPainel.addEventListener('click', () => {
      const url = new URL(location.href);
      url.searchParams.set('painel', '1');
      window.open(url.toString(), '_blank');
    });

    window.addEventListener('keydown', (e) => {
      if (['INPUT', 'SELECT', 'TEXTAREA'].includes(document.activeElement.tagName)) return;
      if (e.key.toLowerCase() === 'n') next();
      else if (e.key.toLowerCase() === 'r') announce();
      else if (e.key.toLowerCase() === 'b') back();
      else if (e.key === '0') resetToZero();
    });

    // Relógio de canto
    setInterval(() => {
      const d = new Date();
      el.clock.textContent = d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    }, 1000);

    // ------------------ Modo painel ------------------
    function applyPanelModeIfNeeded() {
      const isPanel = new URL(location.href).searchParams.get('painel') === '1';
      if (isPanel) {
        document.body.classList.add('panel-only');
      }
    }

    // ------------------ Inicialização ------------------
    function init() {
      applyPanelModeIfNeeded();
      loadState();
      populateVoices();
      el.syncInfo.textContent = channelOk ? 'Canal: BroadcastChannel' : 'Canal: Storage events';
      // solicita interação do usuário para habilitar áudio em alguns navegadores
      document.body.addEventListener('click', onceUnlockAudio, { once: true });
    }

    function onceUnlockAudio() { try { const ctx = new (window.AudioContext || window.webkitAudioContext)(); ctx.resume && ctx.resume(); } catch {}
    }

    init();

// fim painel

  </script>

     

  <script type="module">
    // Importa Firebase (versão modular)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

    // 🔑 Cole aqui os dados do seu app Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDPcPaWLF4dxQ_091qiru1w9HXS05rtcz8",
      authDomain: "fila-atendimento.firebaseapp.com",
      databaseURL: "https://fila-atendimento-default-rtdb.firebaseio.com",
      projectId: "fila-atendimento",
      storageBucket: "fila-atendimento.firebasestorage.app",
      messagingSenderId: "813517035677",
      appId: "1:813517035677:web:caa3fedeac9719ff009c74"
    };

    // Inicializa Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Estado global
    const state = { prefix: "J", number: 0, guiche: "1", ts: Date.now() };

    // Referências aos elementos
    const el = {
      senhaBig: document.getElementById("senhaBig"),
      guicheTxt: document.getElementById("guicheTxt"),
      prefix: document.getElementById("prefix"),
      numero: document.getElementById("numero"),
      guiche: document.getElementById("guiche"),
    };

    const pad = n => String(n).padStart(3, "0");

    function updateDisplay() {
      el.senhaBig.textContent = `${state.prefix}-${pad(state.number)}`;
      el.guicheTxt.textContent = `Dirija-se ao guichê ${state.guiche}`;
      el.prefix.value = state.prefix;
      el.numero.value = state.number;
      el.guiche.value = state.guiche;
    }

    // 🔥 Sincronização com Firebase
    const stateRef = ref(db, "fila/state");

    // Escuta mudanças no banco
    onValue(stateRef, (snapshot) => {
      if (snapshot.exists()) {
        Object.assign(state, snapshot.val());
        updateDisplay();
      }
    });

    // Grava estado no banco
    function broadcast() {
      state.ts = Date.now();
      set(stateRef, state);
    }

    // Eventos UI
    el.prefix.addEventListener("input", () => { state.prefix = el.prefix.value; broadcast(); });
    el.numero.addEventListener("change", () => { state.number = parseInt(el.numero.value || 0); broadcast(); });
    el.guiche.addEventListener("input", () => { state.guiche = el.guiche.value; broadcast(); });

    function next() {
      state.number++;
      broadcast();
    }

    // Atalho no teclado
    window.addEventListener("keydown", (e) => {
      if (e.key.toLowerCase() === "n") next();
    });

    updateDisplay();

    // Esconde controles se for painel
    if (window.location.search.includes("painel=1")) {
      document.getElementById("controles").style.display = "none";
    }
  </script>
</body>
</html>

